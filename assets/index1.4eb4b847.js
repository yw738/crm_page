var te=Object.defineProperty;var E=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var x=(s,o,t)=>o in s?te(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,T=(s,o)=>{for(var t in o||(o={}))le.call(o,t)&&x(s,t,o[t]);if(E)for(var t of E(o))ne.call(o,t)&&x(s,t,o[t]);return s};import{_ as oe,d as q,r as g,q as z,ad as re,L as R,au as se,av as ie,M as V,o as J,af as ue,aw as N,E as k,a6 as I,a0 as A,$ as _,ax as L,a as S,b,f as C,x as m,h as r,u as de,s as pe,e as O,F as ce,g as me,c as H,y as he,U as ye}from"./index.052afee0.js";import{O as fe}from"./add.86f0af7a.js";import{F as ge}from"./FollowTask.dc6c96ed.js";import{A as _e}from"./AddCooperation.ab5de2f8.js";import{U as be}from"./index.72de21bc.js";import"./product.c89f43f1.js";import"./index.4950eb20.js";const ve=q({__name:"index",props:{activeName:{type:String}},emits:["openApp"],setup(s,{emit:o}){const t=s,i=g(null),{user:y}=z();re("calsType","crm:order:list");const n=R({searchData:{queryType:null,keyWords:null,orderState:null,payType:null,dateSignStartDate:null,dateSignEndDate:null,isTopSort:!0},selectList:[],requestData:{companyId:y.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"select",prop:"orderState",placeholder:"\u5BA1\u6279\u72B6\u6001",width:"180px",options:se,change:()=>{}},{type:"daterange",prop:"dateSignStartDate",prop2:"dateSignEndDate",placeholder:"\u7B7E\u5355\u65E5\u671F",change:()=>{}},{type:"select",prop:"payType",placeholder:"\u4ED8\u6B3E\u65B9\u5F0F",width:"180px",options:ie,change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>G()},{label:"\u91CD\u7F6E",handle:()=>P()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",handle:()=>Y()},{label:"\u5BFC\u5165",icon:"Upload",handle:e=>K()},{label:"\u5BFC\u51FA",icon:"Download",handle:()=>j()}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"340px",btnList:[{label:"\u8DDF\u8FDB",type:"primary",size:"small",icon:"Share",handle:(e,l)=>Q(e)},{type:"primary",label:"\u7F16\u8F91",icon:"Edit",size:"small",handle:(e,l)=>Z(e)},{type:"primary",label:"\u7F6E\u9876",size:"small",icon:"SortUp",handle:(e,l)=>X(e)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",handle:(e,l)=>ee(e)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),{searchData:h,searchForm:f,searchHandle:F,tableHandles:w,tableCols:p,pagination:D,tableData:M}=V(n),P=()=>{Object.assign(n.searchData,{queryType:null,keyWords:null,orderState:null,payType:null,dateSignStartDate:null,dateSignEndDate:null,isTopSort:!0})};g();const c=g(null),v=g(null),W=g(null);J(()=>{ue("crm:order:list").then(e=>{n.tableCols=[...e,...n.tableCols]}),u()});let $=e=>{n.selectList=e.selection},j=()=>{let{activeName:e}=t,l=JSON.parse(JSON.stringify(n.searchData));l.queryType=N(t.activeName,L),e=="2"?fileDown("myOrder",l):e=="3"?fileDown("underOrder",l):e=="4"?fileDown("cooperOrder",l):e=="5"&&fileDown("underCooperOrder",l)};const G=()=>{n.pagination.pageIndex=1,u()};let K=e=>{var l;(l=i==null?void 0:i.value)==null||l.init()},Q=(e,l)=>{var a;(a=v==null?void 0:v.value)==null||a.init("order",e)},X=(e,l)=>{k.confirm("\u8BE5\u64CD\u4F5C\u5C06\u7F6E\u9876\u3002","\u786E\u5B9A\u7F6E\u9876\u5417\uFF1F").then(()=>{var a;(a=I)==null||a.top(e.orderId).then(d=>{A.success("\u7F6E\u9876\u6210\u529F"),B()})}).catch(()=>{})},Y=()=>{var e;(e=c==null?void 0:c.value)==null||e.init("add")},Z=(e,l)=>{var a;(a=c==null?void 0:c.value)==null||a.init("edit",e)},ee=(e,l)=>{k.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(async()=>{var a;try{t.activeName=="4"||t.activeName=="5"?await _.cooperation({cooperationType:"DELETE",clientId:e.clientId,cooperationUserId:y.userInfo.id,departmentId:y.userInfo.departmentId}):await((a=I)==null?void 0:a.del(e.orderId)),A.success("\u5220\u9664\u6210\u529F"),B()}catch{}}).catch(()=>{})};const B=()=>{u()},u=async()=>{var l;let e=null;try{let a=JSON.parse(JSON.stringify(n.searchData));a.current=n.pagination.pageIndex,a.size=n.pagination.pageSize,a.queryType=N(t.activeName,L);let{activeName:d}=t;d=="2"?e=await _.getOrderList(a):d=="3"?e=await _.getOrderUnderList(a):d=="4"?e=await _.getOrderCooperList(a):d=="5"&&(e=await _.getOrderUnderCooperList(a)),n.tableData=((l=e==null?void 0:e.data.records)==null?void 0:l.map(ae=>T({},ae)))||[],n.pagination.total=(e==null?void 0:e.data.total)||0}catch{n.tableData=[]}};return(e,l)=>{const a=S("SearchForm"),d=S("TableTemp");return b(),C("div",null,[m(a,{id:"searchForm",searchData:r(h),searchForm:r(f),searchHandle:r(F)},null,8,["searchData","searchForm","searchHandle"]),m(d,{comheight:700,style:{width:"100%"},isBorder:!0,isSelection:!0,isIndex:!1,isPagination:!0,loading:!1,isHandle:!0,isShowPageBtn:!1,tableData:r(M),tableCols:r(p),tableHandles:r(w),pagination:r(D),onRefresh:u,onSelectChage:r($)},null,8,["tableData","tableCols","tableHandles","pagination","onSelectChage"]),m(fe,{ref_key:"addRef",ref:c,onSuccess:u},null,512),m(ge,{ref_key:"followTaskRef",ref:v,onSuccess:u},null,512),m(_e,{ref_key:"addCooperationRef",ref:W,onSuccess:u},null,512),m(be,{ref_key:"uploadFileRef",ref:i,typeName:"order",onSuccess:u},null,512)])}}});var Se=oe(ve,[["__scopeId","data-v-7f8e32b9"]]);const U=[{label:"\u6211\u7684\u8BA2\u5355",value:"2"},{label:"\u4E0B\u5C5E\u8BA2\u5355",value:"3"},{label:"\u6211\u534F\u4F5C\u7684",value:"4"},{label:"\u4E0B\u5C5E\u534F\u4F5C",value:"5"}];const Fe={class:"main"},ke=q({__name:"index1",setup(s){const{user:o}=z();de(),pe();const t=R({activeName:"2",list:U});J(()=>{o.userLevel==1&&(t.list=U.filter(h=>h.value==2||h.value==4)),t.activeName="2"});const{activeName:i,list:y}=V(t),n=(h,f)=>{};return(h,f)=>{const F=S("el-tab-pane"),w=S("el-tabs");return b(),C("div",Fe,[m(w,{modelValue:r(i),"onUpdate:modelValue":f[0]||(f[0]=p=>ye(i)?i.value=p:null),onTabClick:n,type:"border-card"},{default:O(()=>[(b(!0),C(ce,null,me(r(y),(p,D)=>(b(),H(F,{label:p.label,key:D,name:p.value},{default:O(()=>[p.value==r(i)?(b(),H(Se,{key:0,activeName:r(i)},null,8,["activeName"])):he("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}});export{ke as default};
