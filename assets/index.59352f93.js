var ne=Object.defineProperty,oe=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var Z=(y,c,d)=>c in y?ne(y,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):y[c]=d,A=(y,c)=>{for(var d in c||(c={}))se.call(c,d)&&Z(y,d,c[d]);if(X)for(var d of X(c))re.call(c,d)&&Z(y,d,c[d]);return y},Y=(y,c)=>oe(y,ie(c));import{d as P,q as J,r as E,V as ee,L as W,M as G,a as _,h as e,b as p,c as V,e as i,m as k,x as n,f as C,g as U,F as M,aF as K,U as le,y as ae,G as z,$ as te,aD as O,a0 as H,_ as de,an as T,t as N,p as pe,l as ce,ad as me,o as be,af as ye,E as fe}from"./index.6f18bade.js";import{U as _e}from"./index.d98f6ddf.js";import"./index.a2421c88.js";const Fe={class:"flexStart"},ge=k("div",{class:"marginL10"},"\u5143",-1),he={class:"dialog-footer",style:{"text-align":"center"}},ve=z("\u4FDD\u5B58"),Be=z("\u53D6\u6D88"),De=P({__name:"add",props:{type:{type:String,default:"detail"}},emits:["success"],setup(y,{expose:c,emit:d}){J();const w=E(ee),t=W({title:"",visible:!1,TimeOption(u){return u.getTime()<Date.now()-864e5},formData:{invoiceId:"",billDate:"",billMoney:0,orderId:"",clientId:"",billType:"",billContent:"",billNumber:"",handledBy:"",remarks:""},rules:{billDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u5F00\u7968\u65E5\u671F",trigger:"blur"}],billMoney:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F00\u7968\u91D1\u989D",trigger:"blur"}],clientId:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u8054\u5BA2\u6237",trigger:"blur"}],billType:[{required:!0,message:"\u8BF7\u9009\u62E9\u7968\u636E\u7C7B\u578B",trigger:"blur"}],handledBy:[{required:!0,message:"\u8BF7\u9009\u62E9\u7ECF\u624B\u4EBA\u5458",trigger:"blur"}]},employeeList:[],employeeList2:[],openType:"",orderList:[]}),{title:F,visible:B,formData:s,rules:$,employeeList:q,employeeList2:R,TimeOption:j,orderList:I}=G(t);let g=async(u,o={})=>{te.queryEmployee().then(f=>{var a;let r=(a=f.data)==null?void 0:a.map(b=>({label:b.name,value:b.id}));t.employeeList=r}),O.clientOrder().then(f=>{var r;t.employeeList2=(r=f.data)==null?void 0:r.map(a=>A({label:a.clientName,value:a.clientId},a))}).catch(f=>console.log(f)),u=="edit"?t.title="":(t.title="\u6DFB\u52A0\u53D1\u7968\u8BB0\u5F55",Object.assign(t.formData,{})),t.openType=u,t.visible=!0};function m(u){var r;t.orderList=[];let f=((r=(t.employeeList2.filter(a=>a.value==u)||[])[0])==null?void 0:r.businessVOS)||[];f[0]?t.formData.orderId=f[0].orderId:t.formData.orderId="",t.orderList=f}function D(){let u=JSON.parse(JSON.stringify(t.formData));O.add(u).then(()=>{H.success("\u65B0\u589E\u6210\u529F\uFF01"),x(),d("success")})}function L(){let u=JSON.parse(JSON.stringify(t.formData));O.update(u).then(()=>{H.success("\u7F16\u8F91\u6210\u529F\uFF01"),x(),d("success")})}function S(){w.value.validate(u=>{u&&(t.openType=="edit"?L():D())})}function x(){w.value.resetFields(),t.visible=!1,t.title="",Object.assign(t.formData,{invoiceId:"",billDate:"",billMoney:0,orderId:"",clientId:"",billType:"",billContent:"",billNumber:"",handledBy:"",remarks:""})}return c({init:g}),(u,o)=>{const f=_("el-date-picker"),r=_("el-form-item"),a=_("el-input-number"),b=_("el-option"),h=_("el-select"),v=_("el-input"),Q=_("el-button"),ue=_("el-dialog");return e(B)?(p(),V(ue,{key:0,title:e(F),modelValue:e(B),"onUpdate:modelValue":o[9]||(o[9]=l=>le(B)?B.value=l:null),width:"700px",onClose:x,"close-on-click-modal":!1,"append-to-body":""},{footer:i(()=>[k("div",he,[n(Q,{type:"primary",onClick:S},{default:i(()=>[ve]),_:1}),n(Q,{onClick:x},{default:i(()=>[Be]),_:1})])]),default:i(()=>[n(e(ee),{ref_key:"dataFormRef",ref:w,model:e(s),rules:e($),"label-width":"130px"},{default:i(()=>[n(r,{label:"\u5F00\u7968\u65E5\u671F:",prop:"billDate"},{default:i(()=>[n(f,{modelValue:e(s).billDate,"onUpdate:modelValue":o[0]||(o[0]=l=>e(s).billDate=l),style:{width:"100%"},type:"date","disabled-date":e(j),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"\u8BF7\u9009\u62E9"},null,8,["modelValue","disabled-date"])]),_:1}),n(r,{label:"\u5F00\u7968\u91D1\u989D:",prop:"billMoney"},{default:i(()=>[k("div",Fe,[k("div",null,[n(a,{modelValue:e(s).billMoney,"onUpdate:modelValue":o[1]||(o[1]=l=>e(s).billMoney=l),min:0,step:.01,"step-strictly":!0,max:1e17,style:{width:"200px"},"controls-position":"right"},null,8,["modelValue","step"])]),ge])]),_:1}),n(r,{label:"\u5173\u8054\u5BA2\u6237:",prop:"clientId"},{default:i(()=>[n(h,{modelValue:e(s).clientId,"onUpdate:modelValue":o[2]||(o[2]=l=>e(s).clientId=l),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9",onChange:m},{default:i(()=>[(p(!0),C(M,null,U(e(R),l=>(p(),V(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(r,{label:"\u5173\u8054\u8BA2\u5355:"},{default:i(()=>[n(h,{modelValue:e(s).orderId,"onUpdate:modelValue":o[3]||(o[3]=l=>e(s).orderId=l),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:i(()=>[(p(!0),C(M,null,U(e(I),l=>(p(),V(b,{key:l.orderId,label:l.orderTitile,value:l.orderId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(r,{label:"\u7968\u636E\u7C7B\u578B:",prop:"billType"},{default:i(()=>[n(h,{modelValue:e(s).billType,"onUpdate:modelValue":o[4]||(o[4]=l=>e(s).billType=l),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:i(()=>[(p(!0),C(M,null,U(e(K),l=>(p(),V(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(r,{label:"\u7968\u636E\u5185\u5BB9:"},{default:i(()=>[n(v,{modelValue:e(s).billContent,"onUpdate:modelValue":o[5]||(o[5]=l=>e(s).billContent=l),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),n(r,{label:"\u53D1\u7968\u53F7\u7801:"},{default:i(()=>[n(v,{modelValue:e(s).billNumber,"onUpdate:modelValue":o[6]||(o[6]=l=>e(s).billNumber=l),oninput:"value=value.replace(/[^0-9.]/g,'')",placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),n(r,{label:"\u7ECF\u624B\u4EBA\u5458:",prop:"handledBy"},{default:i(()=>[n(h,{modelValue:e(s).handledBy,"onUpdate:modelValue":o[7]||(o[7]=l=>e(s).handledBy=l),style:{width:"100%"},placeholder:"\u8BF7\u8F93\u5165\u5BA2\u6237\u540D\u79F0"},{default:i(()=>[(p(!0),C(M,null,U(e(q),l=>(p(),V(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(r,{label:"\u5907\u6CE8\u4FE1\u606F:"},{default:i(()=>[n(v,{modelValue:e(s).remarks,"onUpdate:modelValue":o[8]||(o[8]=l=>e(s).remarks=l),type:"textarea",rows:6,placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0\u4FE1\u606F",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])):ae("",!0)}}});const Ee=y=>(pe("data-v-5c97bfc6"),y=y(),ce(),y),Ce={class:"task_detail"},ke={class:"cell-item"},Ie={key:0},xe={key:1},Ve={key:2},we=Ee(()=>k("div",{class:"marginB20"},null,-1)),Le={class:"cell-item"},Se=P({__name:"detail",emits:["success"],setup(y,{expose:c,emit:d}){J(),E(null),E(null),E(null);const w=T("openLink");T("openLink1"),T("openLink2"),T("openLink3"),T("openLink4");const t=T("openLink5"),F=W({title:"",visible:!1,formData:{},jbInfoCal:[{label:"\u5F00\u7968\u65E5\u671F",value:"billDate"},{label:"\u5F00\u7968\u91D1\u989D",value:"billMoney"},{label:"\u5173\u8054\u5BA2\u6237",value:"clientName",type:1},{label:"\u5173\u8054\u8BA2\u5355",value:"orderTitile",type:2},{label:"\u7968\u636E\u7C7B\u578B",value:"billType"},{label:"\u7968\u636E\u5185\u5BB9",value:"billContent"},{label:"\u53D1\u7968\u53F7\u7801",value:"billNumber"},{label:"\u53D1\u7968\u7ECF\u624B\u4EBA\u5458",value:"handledByName"},{label:"\u8BA2\u5355\u6240\u5C5E\u4EBA\u5458",value:"belongUserName"}],sysInfoCal:[{label:"\u5F55\u5165\u4EBA\u5458",value:"creatorName"},{label:"\u521B\u5EFA\u65F6\u95F4",value:"createTime"},{label:"\u66F4\u65B0\u65F6\u95F4",value:"updateTime"}],options:[],pagination:{pageSize:10,pageIndex:1,total:0}}),{visible:B,formData:s,jbInfoCal:$,sysInfoCal:q}=G(F);let R=async(g={})=>{F.visible=!0,await O.getDetail(g.invoiceId).then(m=>{let D=m.data||{};Object.assign(F.formData,Y(A({},D),{billType:findLabel(K,D.billType)}))})},j=g=>{let{clientId:m,orderId:D}=F.formData;g==1?w(Y(A({},F.formData),{clientId:m})):g==2&&t(Y(A({},F.formData),{orderId:D}))};function I(){F.visible=!1,F.formData={},d("success")}return c({init:R}),(g,m)=>{const D=_("el-link"),L=_("el-descriptions-item"),S=_("el-descriptions"),x=_("el-dialog");return e(B)?(p(),V(x,{key:0,modelValue:e(B),"onUpdate:modelValue":m[2]||(m[2]=u=>le(B)?B.value=u:null),width:"600px",title:"\u53D1\u7968\u8BE6\u60C5",onClose:I,"close-on-click-modal":!1,"append-to-body":""},{default:i(()=>[k("div",Ce,[n(S,{class:"margin-top",title:"\u57FA\u672C\u4FE1\u606F",column:1,border:""},{default:i(()=>[(p(!0),C(M,null,U(e($),(u,o)=>(p(),V(L,{"label-align":"right",align:"left",label:u.label,key:o,"label-class-name":"my-label","class-name":"my-content"},{label:i(()=>[k("div",ke,N(u.label)+"\uFF1A",1)]),default:i(()=>[u.type==1?(p(),C("span",Ie,[n(D,{onClick:m[0]||(m[0]=f=>e(j)(1)),underline:!1,type:"primary"},{default:i(()=>[z(N(e(s)[u.value]||"-"),1)]),_:2},1024)])):u.type==2?(p(),C("span",xe,[n(D,{onClick:m[1]||(m[1]=f=>e(j)(2)),underline:!1,type:"primary"},{default:i(()=>[z(N(e(s)[u.value]||"-"),1)]),_:2},1024)])):(p(),C("span",Ve,N(e(s)[u.value]||"-"),1))]),_:2},1032,["label"]))),128))]),_:1}),we,n(S,{class:"margin-top",title:"\u7CFB\u7EDF\u4FE1\u606F",column:1,border:""},{default:i(()=>[(p(!0),C(M,null,U(e(q),(u,o)=>(p(),V(L,{"label-align":"right",align:"left",label:u.label,key:o,"label-class-name":"my-label","class-name":"my-content"},{label:i(()=>[k("div",Le,N(u.label)+"\uFF1A",1)]),default:i(()=>[k("span",null,N(e(s)[u.value]||"-"),1)]),_:2},1032,["label"]))),128))]),_:1})])]),_:1},8,["modelValue"])):ae("",!0)}}});var Ae=de(Se,[["__scopeId","data-v-5c97bfc6"]]);const Te={class:"content_box"},$e=P({__name:"index",emits:["openApp"],setup(y,{emit:c}){const{user:d}=J(),w=E(null);me("calsType","crm:client:invoice");const t=W({searchData:{keyWords:null,billingDateStart:null,billingDateEnd:null,billType:null,belongUserId:null,handledBy:null},selectList:[],requestData:{companyId:d.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"daterange",prop:"billingDateStart",prop2:"billingDateEnd",placeholder:"\u5F00\u7968\u65E5\u671F",change:()=>{}},{type:"select",prop:"billType",placeholder:"\u7968\u636E\u7C7B\u578B",width:"180px",options:K,change:()=>{}},{type:"select",prop:"belongUserId",placeholder:"\u8BA2\u5355\u6240\u5C5E\u4EBA\u5458",width:"180px",options:[],change:()=>{}},{type:"select",prop:"handledBy",placeholder:"\u53D1\u7968\u7ECF\u624B\u4EBA\u5458",width:"180px",options:[],change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>x()},{label:"\u91CD\u7F6E",handle:()=>u()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",isShow:()=>d.userLevel==2,handle:()=>L()},{label:"\u5BFC\u51FA",icon:"Download",isShow:()=>d.userLevel==2,handle:()=>S()}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"200px",btnList:[{type:"primary",label:"\u8BE6\u60C5",size:"small",isShow:()=>d.userLevel==2,handle:(a,b)=>o(a)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",isShow:()=>d.userLevel==2,handle:(a,b)=>f(a)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),{searchData:F,searchForm:B,searchHandle:s,tableHandles:$,tableCols:q,pagination:R,tableData:j}=G(t),I=E(),g=E(null),m=E(null);E(null),E(null),E(null),be(()=>{ye("crm:client:invoice").then(a=>{t.tableCols=[...a,...t.tableCols]}),te.queryEmployee().then(a=>{var b,h;t.searchForm[3].options=(b=a.data)==null?void 0:b.map(v=>({label:v.name,value:v.id,departmentId:v.departmentId})),t.searchForm[4].options=(h=a.data)==null?void 0:h.map(v=>({label:v.name,value:v.id,departmentId:v.departmentId}))})});let D=a=>{t.selectList=a.selection},L=()=>{var a;(a=g==null?void 0:g.value)==null||a.init("add",{dialogType:"1"})},S=()=>{window.fileDown("invoicePage",A({},t.searchData))};const x=()=>{t.pagination.pageIndex=1,r()},u=()=>{Object.assign(t.searchData,{keyWords:null,billingDateStart:null,billingDateEnd:null,billType:null,belongUserId:null,handledBy:null})};let o=a=>{var b;(b=m==null?void 0:m.value)==null||b.init(a)},f=(a,b)=>{fe.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(()=>{var h;(h=O)==null||h.del(a.invoiceId).then(v=>{H.success("\u5220\u9664\u6210\u529F"),r()})}).catch(()=>{})};const r=()=>{var a;(a=I==null?void 0:I.value)==null||a.getList()};return(a,b)=>{const h=_("PageLayout");return p(),C("div",Te,[n(h,{ref_key:"pageLayout",ref:I,isSelection:!0,isIndex:!1,isShowPageBtn:!1,tableBtnIsTopRight:!1,searchForm:e(B),searchData:e(F),tableHandles:e($),tableCols:e(q),pagination:e(R),api:e(O).getList,onSelectChage:e(D)},null,8,["searchForm","searchData","tableHandles","tableCols","pagination","api","onSelectChage"]),n(De,{ref_key:"addRef",ref:g,onSuccess:r},null,512),n(Ae,{ref_key:"detailRef",ref:m,onSuccess:r},null,512),n(_e,{ref_key:"uploadFileRef",ref:w,typeName:"garbage",onSuccess:r},null,512)])}}});export{$e as default};
