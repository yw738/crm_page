var ee=Object.defineProperty,ae=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var T=(u,a,t)=>a in u?ee(u,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[a]=t,I=(u,a)=>{for(var t in a||(a={}))ne.call(a,t)&&T(u,t,a[t]);if(N)for(var t of N(a))le.call(a,t)&&T(u,t,a[t]);return u},A=(u,a)=>ae(u,te(a));import{s as oe}from"./dict.c33b8edc.js";import{U as ue}from"./index.72de21bc.js";import{_ as re,d as q,q as z,an as L,ad as se,L as M,ap as ie,M as O,o as V,af as ce,r as D,am as k,aq as P,E as de,$ as y,a7 as pe,a0 as me,a as F,b as f,f as E,x as b,h as r,e as H,F as he,g as ye,c as U,y as fe,U as be}from"./index.052afee0.js";import{A as ge}from"./add.2ec2bbc4.js";import"./index.4950eb20.js";const _e=q({__name:"index",props:{activeName:{type:String}},setup(u){const a=u,{user:t}=z(),s=L("openSms"),C=L("oepnPhone");se("calsType","crm:contact:list");const o=M({msg:"\u53D1\u9001\u8BB0\u5F55\u53EA\u652F\u630120\u5929\u67E5\u8BE2\uFF0C\u5982\u9700\u66F4\u591A\u8BB0\u5F55\u8BF7\u8054\u7CFB\u5BA2\u670D",searchData:{queryType:null,keyWords:null,birthdayQuery:null,departmentalPosition:null,contactStartDate:null,contactEndDate:null,followStartDate:null,followEndDate:null},selectList:[],requestData:{companyId:t.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"select",prop:"birthdayQuery",placeholder:"\u8054\u7CFB\u4EBA\u751F\u65E5",width:"180px",options:ie,change:()=>{}},{type:"input",prop:"departmentalPosition",width:"180px",placeholder:"\u804C\u52A1",change:()=>{}},{type:"daterange",prop:"contactStartDate",prop2:"contactEndDate",placeholder:"\u6700\u540E\u8054\u7CFB",change:()=>{}},{type:"daterange",prop:"followStartDate",prop2:"followEndDate",placeholder:"\u6700\u540E\u8DDF\u8FDB",change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>$()},{label:"\u91CD\u7F6E",handle:()=>Q()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",handle:()=>K()},{label:"\u5BFC\u5165",icon:"Upload",handle:e=>W()},{label:"\u5BFC\u51FA",icon:"Download",handle:()=>R()},{label:"\u53D1\u9001\u77ED\u4FE1",handle:()=>{s(!0,o.selectList)}}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"340px",btnList:[{label:"\u62E8\u6253",type:"primary",size:"small",icon:"Phone",handle:(e,n)=>C(e.cluePhone,e.clientId)},{type:"primary",label:"\u77ED\u4FE1",size:"small",icon:"Message",handle:(e,n)=>s(!0,[e])},{type:"primary",label:"\u7F16\u8F91",icon:"Edit",size:"small",handle:(e,n)=>X(e)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",handle:(e,n)=>G(e)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),{msg:S,searchData:g,searchForm:m,searchHandle:v,tableHandles:w,tableCols:i,pagination:B,tableData:J}=O(o);V(()=>{ce("crm:contact:list").then(e=>{o.tableCols=[...e,...o.tableCols]}),p()});const Q=()=>{Object.assign(o.searchData,{queryType:null,keyWords:null,birthdayQuery:null,departmentalPosition:null,contactStartDate:null,contactEndDate:null,followStartDate:null,followEndDate:null})},_=D(null);let W=e=>{var n;(n=_==null?void 0:_.value)==null||n.init()},j=e=>{o.selectList=e.selection},R=()=>{let{activeName:e}=a,n=JSON.parse(JSON.stringify(o.searchData));n.queryType=k(a.activeName,P),e=="2"?fileDown("myContact",n):e=="3"?fileDown("underContact",n):e=="4"?fileDown("coopContact",n):e=="5"&&fileDown("underCoopContact",n)};const $=()=>{o.pagination.pageIndex=1,p()};D();const c=D(null);D(null);let G=(e,n)=>{de.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(async()=>{var l;try{a.activeName=="4"||a.activeName=="5"?await y.cooperation({cooperationType:"DELETE",clientId:e.clientId,cooperationUserId:t.userInfo.id,departmentId:t.userInfo.departmentId}):await((l=pe)==null?void 0:l.del(e.contactUserId)),me.success("\u5220\u9664\u6210\u529F"),Y()}catch{}}).catch(()=>{})},K=()=>{var e;(e=c==null?void 0:c.value)==null||e.init("add")},X=(e,n)=>{var l;(l=c==null?void 0:c.value)==null||l.init("edit",e)};const Y=()=>{p()},p=async()=>{var n;let e=null;try{let l=JSON.parse(JSON.stringify(o.searchData));l.current=o.pagination.pageIndex,l.size=o.pagination.pageSize,l.queryType=k(a.activeName,P);let{activeName:d}=a;d=="2"?e=await y.getContactMyList(l):d=="3"?e=await y.getContactUnderList(l):d=="4"?e=await y.getContactCooperList(l):d=="5"&&(e=await y.getContactUnderCooperList(l)),o.tableData=((n=e==null?void 0:e.data.records)==null?void 0:n.map(h=>{var x;return A(I({},h),{sendTime:h.sendTime?dateFormat(h.sendTime,!0,!1):"",sendStatus:h.sendStatus?(x=oe.find(Z=>Z.value==h.sendStatus))==null?void 0:x.label:""})}))||[],o.pagination.total=(e==null?void 0:e.data.total)||0}catch{o.tableData=[]}};return(e,n)=>{const l=F("SearchForm"),d=F("TableTemp");return f(),E("div",null,[b(l,{id:"searchForm",searchData:r(g),searchForm:r(m),searchHandle:r(v)},null,8,["searchData","searchForm","searchHandle"]),b(d,{comheight:700,style:{width:"100%"},isBorder:!0,isSelection:!0,isIndex:!1,isPagination:!0,loading:!1,isHandle:!0,isShowPageBtn:!1,tableData:r(J),tableCols:r(i),tableHandles:r(w),pagination:r(B),onRefresh:p,onSelectChage:r(j)},null,8,["tableData","tableCols","tableHandles","pagination","onSelectChage"]),b(ge,{ref_key:"addRef",ref:c,onSuccess:p},null,512),b(ue,{ref_key:"uploadFileRef",ref:_,typeName:"contact",onSuccess:p},null,512)])}}});var De=re(_e,[["__scopeId","data-v-f11ff404"]]);const Fe={class:"main"},xe=q({__name:"index",setup(u){const{user:a}=z(),t=M({activeName:"2",openId:null,openType:"",list:[{label:"\u6211\u7684\u8054\u7CFB\u4EBA",value:"2"},{label:"\u4E0B\u5C5E\u7684\u8054\u7CFB\u4EBA",value:"3"},{label:"\u6211\u534F\u4F5C\u7684",value:"4"},{label:"\u4E0B\u5C5E\u534F\u4F5C\u7684",value:"5"}]}),{activeName:s,list:C,openType:o}=O(t),S=(g,m)=>{t.activeName=g.props.name};return V(()=>{a.userLevel==1&&(t.list=[{label:"\u6211\u7684\u8054\u7CFB\u4EBA",value:"2"},{label:"\u6211\u534F\u4F5C\u7684",value:"4"}]),t.activeName=t.list[0].value}),(g,m)=>{const v=F("el-tab-pane"),w=F("el-tabs");return f(),E("div",Fe,[b(w,{modelValue:r(s),"onUpdate:modelValue":m[0]||(m[0]=i=>be(s)?s.value=i:null),onTabClick:S,type:"border-card"},{default:H(()=>[(f(!0),E(he,null,ye(r(C),(i,B)=>(f(),U(v,{label:i.label,key:B,name:i.value},{default:H(()=>[i.value==r(s)?(f(),U(De,{key:0,activeName:r(s)},null,8,["activeName"])):fe("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}});export{xe as default};
