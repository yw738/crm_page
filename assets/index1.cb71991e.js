var te=Object.defineProperty;var E=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var x=(i,s,t)=>s in i?te(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t,T=(i,s)=>{for(var t in s||(s={}))le.call(s,t)&&x(i,t,s[t]);if(E)for(var t of E(s))ne.call(s,t)&&x(i,t,s[t]);return i};import{_ as se,d as q,r as y,q as z,ad as oe,L as O,ar as ie,a3 as re,a2 as ue,M as V,o as J,af as ce,as as N,E as A,a4 as I,a0 as k,$ as f,at as L,a as w,b as _,f as B,x as d,h as o,u as pe,s as de,e as R,F as me,g as he,c as U,y as be,U as ge}from"./index.6f18bade.js";import{A as ye}from"./add.85cd694e.js";import{F as fe}from"./FollowTask.e925c40f.js";import{A as _e}from"./AddCooperation.9a64fde0.js";import{U as Se}from"./index.d98f6ddf.js";import"./index.a2421c88.js";const we=q({__name:"index",props:{activeName:{type:String}},emits:["openApp"],setup(i,{emit:s}){const t=i,r=y(null),{user:b}=z();oe("calsType","crm:crm:business:list");const n=O({calsType:"businessCals1",searchData:{queryType:null,keyWords:null,salesStage:null,businessSource:null,clinchRate:null,dateSignStartDate:null,dateSignEndDate:null,isTopSort:!0},selectList:[],requestData:{companyId:b.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"select",prop:"salesStage",placeholder:"\u5546\u673A\u9636\u6BB5",width:"180px",options:ie,change:()=>{}},{type:"select",prop:"businessSource",placeholder:"\u5546\u673A\u6765\u6E90",width:"180px",options:re,change:()=>{}},{type:"select",prop:"clinchRate",placeholder:"\u6210\u4EA4\u51E0\u7387",width:"180px",options:ue,change:()=>{}},{type:"daterange",prop:"dateSignStartDate",prop2:"dateSignEndDate",placeholder:"\u9884\u8BA1\u7B7E\u5355\u65E5\u671F",change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>$()},{label:"\u91CD\u7F6E",handle:()=>ee()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",handle:()=>X()},{label:"\u5BFC\u5165",icon:"Upload",handle:e=>G()},{label:"\u5BFC\u51FA",icon:"Download",handle:()=>j()}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"340px",btnList:[{label:"\u8DDF\u8FDB",type:"primary",size:"small",icon:"Share",handle:(e,l)=>K(e)},{type:"primary",label:"\u7F16\u8F91",icon:"Edit",size:"small",handle:(e,l)=>Y(e)},{type:"primary",label:"\u7F6E\u9876",size:"small",icon:"SortUp",handle:(e,l)=>Q(e)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",handle:(e,l)=>Z(e)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),{searchData:m,searchForm:g,searchHandle:v,tableHandles:D,tableCols:c,pagination:F,tableData:M,calsType:Fe}=V(n);y();const p=y(null),S=y(null),P=y(null);J(()=>{ce("crm:crm:business:list").then(e=>{n.tableCols=[...e,...n.tableCols]}),h()});let W=e=>{n.selectList=e.selection};const $=()=>{n.pagination.pageIndex=1,h()};let j=()=>{let{activeName:e}=t,l=JSON.parse(JSON.stringify(n.searchData));l.queryType=N(t.activeName,L),e=="2"?fileDown("myBusiness",l):e=="3"?fileDown("underBusiness",l):e=="4"?fileDown("cooperBusiness",l):e=="5"&&fileDown("cooperUnderBusiness",l)},G=e=>{var l;(l=r==null?void 0:r.value)==null||l.init()},K=(e,l)=>{var a;(a=S==null?void 0:S.value)==null||a.init("business",e)},Q=(e,l)=>{A.confirm("\u8BE5\u64CD\u4F5C\u5C06\u7F6E\u9876\u3002","\u786E\u5B9A\u7F6E\u9876\u5417\uFF1F").then(()=>{var a;(a=I)==null||a.top(e.businessId).then(u=>{k.success("\u7F6E\u9876\u6210\u529F"),C()})}).catch(()=>{})},X=()=>{var e;(e=p==null?void 0:p.value)==null||e.init("add")},Y=(e,l)=>{var a;(a=p==null?void 0:p.value)==null||a.init("edit",e)},Z=(e,l)=>{A.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(async()=>{var a;try{t.activeName=="4"||t.activeName=="5"?await f.cooperation({cooperationType:"DELETE",clientId:e.clientId,cooperationUserId:b.userInfo.id,departmentId:b.userInfo.departmentId}):await((a=I)==null?void 0:a.del(e.businessId)),k.success("\u5220\u9664\u6210\u529F"),C()}catch{}}).catch(()=>{})};const C=()=>{h()},h=async()=>{var l;let e=null;try{let a=JSON.parse(JSON.stringify(n.searchData));a.clinchRate&&a.clinchRate.replace("%",""),a.current=n.pagination.pageIndex,a.size=n.pagination.pageSize,a.followStartDate&&a.followEndDate&&(a.followStartDate=a.followStartDate.split(" ")[0],a.followEndDate=a.followEndDate.split(" ")[0]),a.queryType=N(t.activeName,L);let{activeName:u}=t;u=="2"?e=await f.getBusiList(a):u=="3"?e=await f.getBusiUnderList(a):u=="4"?e=await f.getBusiCooperList(a):u=="5"&&(e=await f.getBusiUnderCooperList(a)),n.tableData=((l=e==null?void 0:e.data.records)==null?void 0:l.map(ae=>T({},ae)))||[],n.pagination.total=(e==null?void 0:e.data.total)||0}catch{n.tableData=[]}},ee=()=>{Object.assign(n.searchData,{queryType:null,keyWords:null,salesStage:null,businessSource:null,clinchRate:null,dateSignStartDate:null,dateSignEndDate:null,isTopSort:!0})};return(e,l)=>{const a=w("SearchForm"),u=w("TableTemp");return _(),B("div",null,[d(a,{id:"searchForm",searchData:o(m),searchForm:o(g),searchHandle:o(v)},null,8,["searchData","searchForm","searchHandle"]),d(u,{comheight:700,style:{width:"100%"},isBorder:!0,isSelection:!0,isIndex:!1,isPagination:!0,loading:!1,isHandle:!0,isShowPageBtn:!1,tableData:o(M),tableCols:o(c),tableHandles:o(D),pagination:o(F),onRefresh:h,onSelectChage:o(W)},null,8,["tableData","tableCols","tableHandles","pagination","onSelectChage"]),d(_e,{ref_key:"addCooperationRef",ref:P},null,512),d(fe,{ref_key:"followTaskRef",ref:S},null,512),d(ye,{ref_key:"addRef",ref:p,onSuccess:h},null,512),d(Se,{ref_key:"uploadFileRef",ref:r,typeName:"business",onSuccess:h},null,512)])}}});var ve=se(we,[["__scopeId","data-v-4b182eeb"]]);const H=[{label:"\u6211\u7684\u5546\u673A",value:"2"},{label:"\u4E0B\u5C5E\u5546\u673A",value:"3"},{label:"\u6211\u534F\u4F5C\u7684",value:"4"},{label:"\u4E0B\u5C5E\u534F\u4F5C",value:"5"}];const De={class:"main"},Ie=q({__name:"index1",setup(i){const{user:s}=z();pe(),de();const t=O({activeName:"",openId:null,openType:"",list:H});J(()=>{s.userLevel==1&&(t.list=H.filter(m=>m.value==2||m.value==4)),t.activeName="2"});const{activeName:r,list:b}=V(t),n=(m,g)=>{};return(m,g)=>{const v=w("el-tab-pane"),D=w("el-tabs");return _(),B("div",De,[d(D,{modelValue:o(r),"onUpdate:modelValue":g[0]||(g[0]=c=>ge(r)?r.value=c:null),onTabClick:n,type:"border-card"},{default:R(()=>[(_(!0),B(me,null,he(o(b),(c,F)=>(_(),U(v,{label:c.label,key:F,name:c.value},{default:R(()=>[c.value==o(r)?(_(),U(ve,{key:0,activeName:o(r)},null,8,["activeName"])):be("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}});export{Ie as default};
