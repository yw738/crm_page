var ce=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var Z=(v,c,_)=>c in v?ce(v,c,{enumerable:!0,configurable:!0,writable:!0,value:_}):v[c]=_,P=(v,c)=>{for(var _ in c||(c={}))_e.call(c,_)&&Z(v,_,c[_]);if(X)for(var _ of X(c))ye.call(c,_)&&Z(v,_,c[_]);return v},Y=(v,c)=>me(v,fe(c));import{d as J,q as te,r as T,V as ee,L as W,M as G,a as b,h as e,b as p,c as C,e as a,m as h,x as l,f as D,g as S,F as x,aB as K,aC as ue,U as ne,y as oe,G as M,$ as be,aD as ve,aE as $,a0 as H,_ as he,an as le,az as Ee,t as U,H as ae,p as Fe,l as ge,E as se,ad as De,o as Be,af as Ce}from"./index.6f18bade.js";import{U as ke}from"./index.d98f6ddf.js";import"./index.a2421c88.js";const Ie={gutter:20},we={span:11},Ae={class:"flexStart"},xe=h("div",{class:"marginL10"},"\u5143",-1),Ve=M(" \u6CE8\uFF1A\u5BA1\u6279\u5B8C\u6210\u540E\uFF0C\u5C06\u81EA\u52A8\u901A\u77E5\u5230\u6240\u9009\u4EBA\u5458\u3002 "),Le={class:"dialog-footer",style:{"text-align":"center"}},Se=M("\u63D0\u4EA4\u5BA1\u6279"),Te=M("\u91CD\u7F6E"),re=J({__name:"add",emits:["success"],setup(v,{expose:c,emit:_}){te();const F=T(ee);T(null),T(null);const r=W({title:"",visible:!1,TimeOption(d){return d.getTime()<Date.now()-864e5},formData:{refundId:"",refundDate:"",refundMoney:0,orderId:"",clientId:"",payType:"",cashierId:"",remindPeople:[],remarks:"",paymentType:""},rules:{refundDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",trigger:"blur"}],refundMoney:[{required:!0,message:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D",trigger:"blur"}],clientId:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u8054\u5BA2\u6237",trigger:"blur"}],orderId:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u8054\u8BA2\u5355",trigger:"blur"}],cashierId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6536\u6B3E\u4EBA\u5458",trigger:"blur"}]},openType:"",employeeList2:[],orderList:[],employeeList3:[]}),{title:V,visible:y,formData:i,rules:w,TimeOption:O,employeeList2:q,orderList:A,employeeList3:k}=G(r);let L=async(d,u={})=>{r.visible=!0,be.queryEmployee().then(n=>{var s;let o=(s=n.data)==null?void 0:s.map(B=>({label:B.name,value:B.id}));r.employeeList3=o}),await ve.clientOrder().then(n=>{var o;r.employeeList2=(o=n.data)==null?void 0:o.map(s=>P({label:s.clientName,value:s.clientId},s))}).catch(n=>console.log(n)),d=="edit"?(r.title="\u7F16\u8F91\u56DE\u6B3E",await $.getDetail(u.refundId).then(n=>{var s;let o=n.data;if(Object.assign(r.formData,P({},o)),o.remindPeople&&(r.formData.remindPeople=o.remindPeople.split(",")),o.clientId){let B=((s=r==null?void 0:r.employeeList2)==null?void 0:s.find(m=>m.clientId==o.clientId))||{};r.orderList=(B==null?void 0:B.businessVOS)||[]}}).catch(n=>console.log(n))):r.title="\u6DFB\u52A0\u56DE\u6B3E",r.openType=d};function j(d){var o;r.orderList=[];let n=((o=(r.employeeList2.filter(s=>s.value==d)||[])[0])==null?void 0:o.businessVOS)||[];n[0]?r.formData.orderId=n[0].orderId:r.formData.orderId="",r.orderList=n}async function R(){var u;let d=JSON.parse(JSON.stringify(r.formData));d.remindPeople=((u=d==null?void 0:d.remindPeople)==null?void 0:u.join(","))||null,$.add(d).then(()=>{H.success("\u65B0\u589E\u6210\u529F\uFF01"),f(),_("success")})}function N(){var u;let d=JSON.parse(JSON.stringify(r.formData));d.remindPeople=((u=d==null?void 0:d.remindPeople)==null?void 0:u.join(","))||null,$.update(d).then(()=>{H.success("\u7F16\u8F91\u6210\u529F\uFF01"),f(),_("success")})}function E(){F.value.validate(d=>{d&&(r.openType=="edit"?N():R())})}function f(){F.value.resetFields(),r.visible=!1,r.title="",g()}function g(d=!1){Object.assign(r.formData,{refundId:"",refundDate:"",refundMoney:0,orderId:"",clientId:"",payType:"",cashierId:"",remindPeople:[],remarks:"",paymentType:""})}return c({init:L}),(d,u)=>{const n=b("el-date-picker"),o=b("el-form-item"),s=b("el-col"),B=b("el-input-number"),m=b("el-option"),I=b("el-select"),z=b("el-row"),ie=b("el-input"),Q=b("el-button"),pe=b("el-dialog");return e(y)?(p(),C(pe,{key:0,title:e(V),modelValue:e(y),"onUpdate:modelValue":u[11]||(u[11]=t=>ne(y)?y.value=t:null),width:"1200px",onClose:f,"close-on-click-modal":!1,"append-to-body":""},{footer:a(()=>[h("div",Le,[l(Q,{type:"primary",onClick:u[9]||(u[9]=t=>E())},{default:a(()=>[Se]),_:1}),l(Q,{onClick:u[10]||(u[10]=t=>g(!0))},{default:a(()=>[Te]),_:1})])]),default:a(()=>[l(e(ee),{ref_key:"dataFormRef",ref:F,model:e(i),rules:e(w),"label-width":"110px"},{default:a(()=>[h("div",Ie,[h("div",we,[l(z,{gutter:20},{default:a(()=>[l(s,{span:12},{default:a(()=>[l(o,{label:"\u56DE\u6B3E\u65E5\u671F:",prop:"refundDate"},{default:a(()=>[l(n,{modelValue:e(i).refundDate,"onUpdate:modelValue":u[0]||(u[0]=t=>e(i).refundDate=t),style:{width:"100%"},type:"date","disabled-date":e(O),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"\u8BF7\u9009\u62E9"},null,8,["modelValue","disabled-date"])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u56DE\u6B3E\u91D1\u989D:",prop:"refundMoney"},{default:a(()=>[h("div",Ae,[h("div",null,[l(B,{modelValue:e(i).refundMoney,"onUpdate:modelValue":u[1]||(u[1]=t=>e(i).refundMoney=t),min:0,step:.01,"step-strictly":!0,max:1e17,style:{width:"200px"},"controls-position":"right"},null,8,["modelValue","step"])]),xe])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u5173\u8054\u5BA2\u6237:",prop:"clientId"},{default:a(()=>[l(I,{modelValue:e(i).clientId,"onUpdate:modelValue":u[2]||(u[2]=t=>e(i).clientId=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9",onChange:j},{default:a(()=>[(p(!0),D(x,null,S(e(q),t=>(p(),C(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u5173\u8054\u8BA2\u5355:",prop:"orderId"},{default:a(()=>[l(I,{modelValue:e(i).orderId,"onUpdate:modelValue":u[3]||(u[3]=t=>e(i).orderId=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[(p(!0),D(x,null,S(e(A),t=>(p(),C(m,{key:t.orderId,label:t.orderTitile,value:t.orderId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u4ED8\u6B3E\u65B9\u5F0F:"},{default:a(()=>[l(I,{modelValue:e(i).payType,"onUpdate:modelValue":u[4]||(u[4]=t=>e(i).payType=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[(p(!0),D(x,null,S(e(K),t=>(p(),C(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u56DE\u6B3E\u7C7B\u578B:"},{default:a(()=>[l(I,{modelValue:e(i).paymentType,"onUpdate:modelValue":u[5]||(u[5]=t=>e(i).paymentType=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[(p(!0),D(x,null,S(e(ue),t=>(p(),C(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u6536\u6B3E\u4EBA\u5458:",prop:"cashierId"},{default:a(()=>[l(I,{modelValue:e(i).cashierId,"onUpdate:modelValue":u[6]||(u[6]=t=>e(i).cashierId=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9"},{default:a(()=>[(p(!0),D(x,null,S(e(k),t=>(p(),C(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),h("div",null,[l(z,{gutter:20},{default:a(()=>[l(s,{span:12},{default:a(()=>[l(o,{label:"\u5907\u6CE8\u4FE1\u606F:"},{default:a(()=>[l(ie,{modelValue:e(i).remarks,"onUpdate:modelValue":u[7]||(u[7]=t=>e(i).remarks=t),type:"textarea",rows:6,maxlength:"300","show-word-limit":"",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12}),l(s,{span:12},{default:a(()=>[l(o,{label:"\u901A\u77E5\u4EBA\u5458:"},{default:a(()=>[l(I,{modelValue:e(i).remindPeople,"onUpdate:modelValue":u[8]||(u[8]=t=>e(i).remindPeople=t),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9",multiple:""},{default:a(()=>[(p(!0),D(x,null,S(e(k),t=>(p(),C(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12}),l(s,{span:12},{default:a(()=>[l(o,{label:" "},{default:a(()=>[Ve]),_:1})]),_:1})]),_:1})])])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])):oe("",!0)}}});const de=v=>(Fe("data-v-54ae126a"),v=v(),ge(),v),Pe={class:"flexBetween marginB10"},Ue={class:"el-descriptions__title"},$e=M("\u7F16\u8F91"),Me=M("\u5220\u9664"),Ne=de(()=>h("div",{class:"marginB20"},null,-1)),Oe={class:"task_detail"},je={class:"cell-item"},Re={key:0},qe={key:1},ze={key:2},Ye=de(()=>h("div",{class:"marginB20"},null,-1)),He={class:"cell-item"},Je=J({__name:"detail",emits:["success"],setup(v,{expose:c,emit:_}){const F=le("openLink"),r=le("openLink5"),V=T(null),y=W({title:"",visible:!1,formData:{},jbInfoCal:[{label:"\u56DE\u6B3E\u65E5\u671F",value:"refundDate"},{label:"\u56DE\u6B3E\u91D1\u989D",value:"refundMoney"},{label:"\u5173\u8054\u5BA2\u6237",value:"clientName",type:1},{label:"\u5173\u8054\u8BA2\u5355",value:"orderTitile",type:2},{label:"\u4ED8\u6B3E\u65B9\u5F0F",value:"payType"},{label:"\u56DE\u6B3E\u7C7B\u578B",value:"paymentType"},{label:"\u6536\u6B3E\u4EBA\u5458",value:"cashierName"},{label:"\u5F52\u5C5E\u4EBA\u5458",value:"belongUserName"},{label:"\u5907\u6CE8\u4FE1\u606F",value:"remarks"}],sysInfoCal:[{label:"\u7CFB\u7EDF\u7F16\u53F7",value:"refundId"},{label:"\u63D0\u4EA4\u4EBA\u5458",value:"creatorName"},{label:"\u901A\u77E5\u4ED6\u4EBA",value:"remindPeople"},{label:"\u63D0\u4EA4\u65F6\u95F4",value:"updateTime"}],options:[],pagination:{pageSize:10,pageIndex:1,total:0}}),{visible:i,formData:w,jbInfoCal:O,sysInfoCal:q}=G(y);let A=async(E={})=>{y.visible=!0,await $.getDetail(E.refundId).then(f=>{let g=f.data||{};Object.assign(y.formData,Y(P({},g),{payType:findLabel(K,g.payType),paymentType:findLabel(ue,g.paymentType)}))})},k=E=>{let{clientId:f,orderId:g}=y.formData;E==1?F(Y(P({},y.formData),{clientId:f})):E==2&&r(Y(P({},y.formData),{orderId:g}))},L=()=>{var f;let E=y.formData;(f=V==null?void 0:V.value)==null||f.init("edit",E)},j=()=>{let E=y.formData;A(E)},R=()=>{se.confirm("\u662F\u5426\u786E\u5B9A\u5220\u9664?","\u64CD\u4F5C\u786E\u8BA4").then(()=>{$.del(y.formData.taskId).then(E=>{H.success("\u5220\u9664\u6210\u529F"),N()})}).catch(()=>{})};function N(){y.visible=!1,y.formData={},_("success")}return c({init:A}),(E,f)=>{const g=b("el-button"),d=b("el-card"),u=b("el-link"),n=b("el-descriptions-item"),o=b("el-descriptions"),s=b("el-dialog"),B=Ee("has-perm");return p(),D(x,null,[e(i)?(p(),C(s,{key:0,modelValue:e(i),"onUpdate:modelValue":f[2]||(f[2]=m=>ne(i)?i.value=m:null),width:"1200px",onClose:N,"close-on-click-modal":!1,"append-to-body":""},{default:a(()=>[l(d,{shadow:"never"},{default:a(()=>[h("div",Pe,[h("div",Ue," \u3010"+U(e(w).orderTitile||"-")+"\u3011 ",1),h("div",null,[ae((p(),C(g,{onClick:e(L),plain:"",type:"primary",icon:"Plus"},{default:a(()=>[$e]),_:1},8,["onClick"])),[[B,"crm:client:invoice:update"]]),ae((p(),C(g,{onClick:e(R),type:"danger",plain:"",icon:"Delete"},{default:a(()=>[Me]),_:1},8,["onClick"])),[[B,"crm:client:invoice:delete"]])])])]),_:1}),Ne,l(d,{shadow:"never"},{default:a(()=>[h("div",Oe,[l(o,{class:"margin-top",title:"\u57FA\u672C\u4FE1\u606F",column:2,border:""},{default:a(()=>[(p(!0),D(x,null,S(e(O),(m,I)=>(p(),C(n,{"label-align":"right",align:"left",label:m.label,key:I,"label-class-name":"my-label","class-name":"my-content"},{label:a(()=>[h("div",je,U(m.label)+"\uFF1A",1)]),default:a(()=>[m.type==1?(p(),D("span",Re,[l(u,{onClick:f[0]||(f[0]=z=>e(k)(1)),underline:!1,type:"primary"},{default:a(()=>[M(U(e(w)[m.value]||"-"),1)]),_:2},1024)])):m.type==2?(p(),D("span",qe,[l(u,{onClick:f[1]||(f[1]=z=>e(k)(2)),underline:!1,type:"primary"},{default:a(()=>[M(U(e(w)[m.value]||"-"),1)]),_:2},1024)])):(p(),D("span",ze,U(e(w)[m.value]||"-"),1))]),_:2},1032,["label"]))),128))]),_:1}),Ye,l(o,{class:"margin-top",title:"\u5BA1\u6279\u4FE1\u606F",column:2,border:""},{default:a(()=>[(p(!0),D(x,null,S(e(q),(m,I)=>(p(),C(n,{"label-align":"right",align:"left",label:m.label,key:I,"label-class-name":"my-label","class-name":"my-content"},{label:a(()=>[h("div",He,U(m.label)+"\uFF1A",1)]),default:a(()=>[h("span",null,U(e(w)[m.value]||"-"),1)]),_:2},1032,["label"]))),128))]),_:1})])]),_:1})]),_:1},8,["modelValue"])):oe("",!0),l(re,{ref_key:"addRef",ref:V,onSuccess:e(j)},null,8,["onSuccess"])],64)}}});var We=he(Je,[["__scopeId","data-v-54ae126a"]]);const Ge={class:"content_box"},el=J({__name:"index",setup(v){const{user:c}=te(),_=T(null);De("calsType","crm:client:refund");const F=W({searchData:{keyWords:null,startDate:null,endDate:null,payType:null,refundState:null},selectList:[],requestData:{companyId:c.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"select",prop:"payType",placeholder:"\u4ED8\u6B3E\u65B9\u5F0F",width:"180px",options:K,change:()=>{}},{type:"daterange",prop:"startDate",prop2:"endDate",placeholder:"\u56DE\u6B3E\u65E5\u671F",change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>E()},{label:"\u91CD\u7F6E",handle:()=>f()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",isShow:()=>c.userLevel==2,handle:()=>R()},{label:"\u5BFC\u51FA",icon:"Download",isShow:()=>c.userLevel==2,handle:()=>N()}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"200px",btnList:[{type:"primary",label:"\u8BE6\u60C5",size:"small",isShow:()=>c.userLevel==2,handle:(n,o)=>g(n)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",isShow:()=>c.userLevel==2,handle:(n,o)=>d(n)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),{searchData:r,searchForm:V,searchHandle:y,tableHandles:i,tableCols:w,pagination:O,tableData:q}=G(F),A=T(),k=T(null),L=T(null);Be(()=>{Ce("crm:client:refund").then(n=>{F.tableCols=[...n,...F.tableCols]})});let j=n=>{F.selectList=n.selection},R=()=>{var n;(n=k==null?void 0:k.value)==null||n.init("add",{dialogType:"1"})},N=()=>{window.fileDown("refundPage",P({},F.searchData))};const E=()=>{F.pagination.pageIndex=1,u()},f=()=>{Object.assign(F.searchData,{keyWords:null,startDate:null,endDate:null,payType:null,refundState:null})};let g=n=>{var o;(o=L==null?void 0:L.value)==null||o.init(n)},d=(n,o)=>{se.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(()=>{var s;(s=$)==null||s.del(n.refundId).then(B=>{H.success("\u5220\u9664\u6210\u529F"),u()})}).catch(()=>{})};const u=()=>{var n;(n=A==null?void 0:A.value)==null||n.getList()};return(n,o)=>{const s=b("PageLayout");return p(),D("div",Ge,[l(s,{ref_key:"pageLayout",ref:A,isSelection:!0,isIndex:!1,isShowPageBtn:!1,tableBtnIsTopRight:!1,searchForm:e(V),searchData:e(r),tableHandles:e(i),tableCols:e(w),pagination:e(O),api:e($).getList,onSelectChage:e(j)},null,8,["searchForm","searchData","tableHandles","tableCols","pagination","api","onSelectChage"]),l(re,{ref_key:"addRef",ref:k,onSuccess:u},null,512),l(We,{ref_key:"detailRef",ref:L,onSuccess:u},null,512),l(ke,{ref_key:"uploadFileRef",ref:_,typeName:"garbage",onSuccess:u},null,512)])}}});export{el as default};
