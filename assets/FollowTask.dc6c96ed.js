var J=Object.defineProperty,z=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var h=(e,n,u)=>n in e?J(e,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[n]=u,V=(e,n)=>{for(var u in n||(n={}))G.call(n,u)&&h(e,u,n[u]);if(C)for(var u of C(n))W.call(n,u)&&h(e,u,n[u]);return e},I=(e,n)=>z(e,Y(n));import{a8 as f,a9 as c,aa as y,_ as H,d as K,q as Q,r as X,V as U,L as Z,M as ee,a as s,h as r,b as D,c as k,e as i,m as le,x as m,f as oe,g as te,W as ae,F as ne,y as _,U as re,G as E,aj as ue,$ as ie,a0 as N}from"./index.052afee0.js";const d={addClientFollow:e=>c("/crm-core/follow/add-client-follow",e),updateClientFollow:e=>c("/crm-core/follow/update-client-follow",e),delClientFollow:e=>y(`/crm-core/follow/delete-client-follow/${e}`,{}),addClueFollow:e=>c("/crm-core/follow/add-clue-follow",e),updateClueFollow:e=>c("/crm-core/follow/update-clue-follow",e),delClueFollow:e=>y(`/crm-core/follow/delete-clue-follow/${e}`,{}),addBusinessFollow:e=>c("/crm-core/follow/add-business-follow",e),updateBusinessFollow:e=>c("/crm-core/follow/update-business-follow",e),delBusinessFollow:e=>y(`/crm-core/follow/delete-business-follow/${e}`,{}),addOrderFollow:e=>c("/crm-core/follow/add-order-follow",e),updateOrderFollow:e=>c("/crm-core/follow/update-order-follow",e),delOrderFollow:e=>y(`/crm-core/follow/delete-order-follow/${e}`,{}),getList:e=>f("/crm-core/follow/query-info",e),getContact:e=>f(`/crm-core/follow/client-contact/${e}`,{}),getDetail1:e=>f(`/crm-core/follow/client-follow-details/${e}`,{}),getDetail2:e=>f(`/crm-core/follow/clue-follow-details/${e}`,{}),getDetail3:e=>f(`/crm-core/follow/business-follow-details/${e}`,{}),getDetail4:e=>f(`/crm-core/follow/order-follow-details/${e}`,{})};const ce={class:"dialog-footer",style:{"text-align":"center"}},se=E("\u4FDD\u5B58"),de=E("\u53D6\u6D88"),me=K({__name:"FollowTask",props:{type:{type:String}},emits:["success"],setup(e,{expose:n,emit:u}){const{user:S}=Q(),x=X(U),t=Z({title:"",visible:!1,formData:{clientFollowId:"",clientId:"",clientState:"",contactUserId:"",followType:0,followTime:"",followContent:"",remindPeople:[],nextFollowTime:"",nextFollowContent:"",nextFollowUserId:"",followUpReminder:"",followUpTypes:[]},checked1:!1,rules:{clientName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BA2\u6237\u540D\u79F0",trigger:"blur"}],clientState:[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA2\u6237\u72B6\u6001",trigger:"blur"}],contactUserId:[{required:!0,message:"\u8BF7\u9009\u62E9\u8054\u7CFB\u4EBA",trigger:"blur"}],nextFollowTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u65F6\u95F4",trigger:"blur"}],nextFollowUserId:[{required:!0,message:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u4EBA\u5458",trigger:"blur"}]},cdOption:[{label:"\u91CD\u8981",value:"1"},{label:"\u7D27\u6025",value:"2"},{label:"\u666E\u901A",value:"3"},{label:"\u91CD\u8981\u4E14\u7D27\u6025",value:"4"}],options:[],clientNameList:[],contactUserList:[],remindPeople:[],props1:{checkStrictly:!0,value:"id",label:"name"},allList:[],rowsData:{},openType:""}),{title:fe,visible:F,formData:p,rules:O,checked1:pe,openType:b,clientNameList:we,contactUserList:_e,remindPeople:Fe}=ee(t);let $=async(l="",o={})=>{t.rowsData=o,Object.assign(t.formData,{clientId:o.clientId,clientName:o.clientName,followTime:getTime(!0),followType:0,nextFollowUserId:S.userInfo.id,followUpReminder:ue[0].value}),t.visible=!0,l=="customer"?Object.assign(t.formData,{clientType:o.clientType}):l=="clue"?Object.assign(t.formData,{clientFollowId:o.clientFollowId||"",clueState:o.clueState}):l=="business"?Object.assign(t.formData,{businessId:o.businessId}):l=="order"&&Object.assign(t.formData,{orderFollowId:o.orderFollowId||"",orderTitile:o.orderTitile,orderId:o.orderId}),await ie.queryEmployee().then(w=>{var B;t.remindPeople=(B=w.data)==null?void 0:B.map(v=>({label:v.name,value:v.id}))}),o.isEdit&&Object.assign(t.formData,I(V({},o),{remindPeople:o.remindPeople?o.remindPeople.split(","):[]})),t.openType=l};async function A(){let l=JSON.parse(JSON.stringify(t.formData)),{openType:o}=t;l.remindPeople=l.remindPeople.join(","),l.followUpTypes=["SYSTEM_INFORMATION"],t.checked1||(delete l.nextFollowTime,delete l.nextFollowContent,delete l.nextFollowUserId,delete l.followUpReminder);try{o=="customer"?await d.addClientFollow(l):o=="clue"?await d.addClueFollow(l):o=="business"?await d.addBusinessFollow(l):o=="order"&&await d.addOrderFollow(l),N.success("\u65B0\u589E\u6210\u529F\uFF01"),g(),u("success")}catch{}}async function R(){let l=JSON.parse(JSON.stringify(t.formData)),{openType:o}=t;l.remindPeople=l.remindPeople.join(","),l.followUpTypes=["SYSTEM_INFORMATION"],t.checked1||(delete l.nextFollowTime,delete l.nextFollowContent,delete l.nextFollowUserId,delete l.followUpReminder);try{o=="customer"?await d.updateClientFollow(l):o=="clue"?await d.updateClueFollow(l):o=="business"?await d.updateBusinessFollow(l):o=="order"&&await d.updateOrderFollow(l),N.success("\u7F16\u8F91\u6210\u529F\uFF01"),g(),u("success",l)}catch{}}function q(){let l=t.formData;x.value.validate(o=>{o&&(l.businessFollowId||l.orderFollowId||l.clientFollowId?R():A())})}function g(){x.value.resetFields(),t.visible=!1,t.title="",t.formData={clientFollowId:"",clientId:"",clientState:"",contactUserId:"",followType:0,followTime:"",followContent:"",remindPeople:[],nextFollowTime:"",nextFollowContent:"",nextFollowUserId:"",followUpReminder:"",followUpTypes:[]}}return n({init:$}),(l,o)=>{const w=s("el-option"),B=s("el-select"),v=s("el-form-item"),L=s("el-input"),P=s("el-col"),j=s("el-row"),T=s("el-button"),M=s("el-dialog");return r(F)?(D(),k(M,{key:0,title:"\u8DDF\u8FDB\u4EFB\u52A1",modelValue:r(F),"onUpdate:modelValue":o[7]||(o[7]=a=>re(F)?F.value=a:null),width:"700px",onClose:g,"close-on-click-modal":!1,"append-to-body":""},{footer:i(()=>[le("div",ce,[m(T,{type:"primary",onClick:q},{default:i(()=>[se]),_:1}),m(T,{onClick:g},{default:i(()=>[de]),_:1})])]),default:i(()=>[m(r(U),{ref_key:"dataFormRef",ref:x,model:r(p),rules:r(O),"label-width":"100px"},{default:i(()=>[r(b)=="customer"?(D(),k(v,{key:0,label:"\u5BA2\u6237\u7B49\u7EA7:"},{default:i(()=>[m(B,{modelValue:r(p).clientType,"onUpdate:modelValue":o[0]||(o[0]=a=>r(p).clientType=a),style:{width:"100%"}},{default:i(()=>[(D(!0),oe(ne,null,te(r(ae),a=>(D(),k(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):_("",!0),(r(b)=="clue",_("",!0)),(r(b)=="business",_("",!0)),(r(b)=="order",_("",!0)),m(j,{gutter:20},{default:i(()=>[m(P,{span:24,class:"marginB20"},{default:i(()=>[m(L,{modelValue:r(p).followContent,"onUpdate:modelValue":o[6]||(o[6]=a=>r(p).followContent=a),type:"textarea",rows:6,maxlength:"300","show-word-limit":"",placeholder:"\u8BF7\u8DDF\u8FDB,\u591A\u7B7E\u5355",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])):_("",!0)}}});var Be=H(me,[["__scopeId","data-v-31e983cf"]]);export{Be as F,d as f};
