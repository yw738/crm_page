var Q=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var j=(l,a,e)=>a in l?Q(l,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[a]=e,L=(l,a)=>{for(var e in a||(a={}))ee.call(a,e)&&j(l,e,a[e]);if($)for(var e of $(a))ae.call(a,e)&&j(l,e,a[e]);return l},q=(l,a)=>X(l,Z(a));import{d as U,w as te,K as J,B as le,R as ne,S as re,A as ue,b as p,f as A,n as oe,J as se,_ as ie,an as de,s as ce,q as me,L as W,M as G,o as K,a as h,az as pe,m as f,x as i,e as d,h as t,F as H,g as P,c as k,t as Y,H as _e,G as M,y as be,U as he}from"./index.6f18bade.js";import{c as z}from"./index.8947268d.js";import{r as fe,i as ve}from"./resize.601b8c7d.js";const De=["id"],ge=U({__name:"PieChart",props:{id:{type:String,default:"pieChart5"},className:{type:String,default:""},width:{type:String,default:"100%",required:!0},height:{type:String,default:"100%",required:!0},data:{type:Object,default:()=>({})}},setup(l){const a=l,{mounted:e,chart:c,beforeDestroy:C,activated:g,deactivated:v}=fe();function y(){const _=ve(document.getElementById(a.id));let{arr1:n=[],arr2:B=[],xAxis:x=[],label:I=[]}=a.data,T=(n==null?void 0:n.sort((R,w)=>w-R)[0])||1e4,O=Math.ceil(Number(T/5));_.setOption({grid:{left:"2%",top:"2%",right:"2%",bottom:"10%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},legend:{x:"center",y:"bottom",data:I},xAxis:[{type:"category",data:x,axisPointer:{type:"shadow"}}],yAxis:[{type:"value",min:0,max:T,interval:O,axisLabel:{formatter:"{value} "}},{type:"value",min:0,max:100,interval:20,axisLabel:{formatter:"{value}%"}}],series:[{name:I[0],type:"bar",data:n,barWidth:20,itemStyle:{color:"#3aa1ff"}},{name:I[1],type:"bar",data:B,barWidth:20,itemStyle:{color:"#4ecb73"}}]}),c.value=_}return te(()=>a.data,()=>{J(()=>{y()})}),le(()=>{C()}),ne(()=>{g()}),re(()=>{v()}),ue(()=>{e();let _=null;_=setInterval(()=>{var n;(n=a.data)!=null&&n.xAxis&&J(()=>{y(),clearInterval(_)})},100)}),(_,n)=>(p(),A("div",{id:l.id,class:oe(l.className),style:se({height:l.height,width:l.width})},null,14,De))}});const ye=M("\u67E5\u8BE2"),xe=M("\u91CD\u7F6E"),Ee={class:"marginB20 marginT20"},Ae={class:"flexBetween marginB10"},Ce={class:"tab_head"},Be=M("\u5BFC\u51FA"),Ie=U({__name:"index",props:{activeName:{type:String}},setup(l){const a=l;de("openLink2"),ce(),me();const e=W({searchData:{year:"",departmentId:"",userId:""},tableHandles:[],tableCols:[{label:"\u65F6\u95F4",prop:"time"},{label:"\u76EE\u6807\u91D1\u989D",prop:"targetAmount"},{label:"\u6210\u4EA4\u91D1\u989D",prop:"turnover"},{label:"\u6210\u4EA4\u8BA2\u5355",prop:"closingOrder"},{label:"\u5B8C\u6210\u7387",prop:"completionRate"},{label:"\u5E73\u5747\u5BA2\u5355\u4EF7",prop:"averageCustomerPrice"}],pagination:{pageSize:10,pageIndex:1,total:0},tableData:[],chartData:[],userId:[],departmentId:[],tabData:{}}),{searchData:c,departmentId:C,userId:g,tableHandles:v,tableCols:y,pagination:_,tableData:n,chartData:B,tabData:x}=G(e);function I(o){var b;e.searchData.userId="";let r=((b=e.departmentId)==null?void 0:b.find(s=>s.value==o))||{};e.userId=r.persons||[]}K(async()=>{let{activeName:o}=a;o=="2"&&(e.tableCols=[{label:"\u65F6\u95F4",prop:"time"},{label:"\u76EE\u6807\u91D1\u989D",prop:"targetAmount"},{label:"\u56DE\u6B3E\u91D1\u989D",prop:"refundAmount"},{label:"\u5B8C\u6210\u7387",prop:"completionRate"}]),e.searchData.year="2023",z.departmentList().then(r=>{var b;e.departmentId=((b=r==null?void 0:r.data)==null?void 0:b.map(s=>q(L({},s),{label:s.departmentName,value:s.departmentId})))||[]}),w()});let T=()=>{let{activeName:o}=a;o=="1"?window.fileDown("turnover",e.searchData):window.fileDown("refundAmount",e.searchData)};const O=()=>{Object.assign(e.searchData,{departmentId:"",userId:""}),e.userId=[]},R=()=>{w()},w=async()=>{var r,b;let o=null;try{let s=JSON.parse(JSON.stringify(e.searchData)),{activeName:S}=a;S=="1"?o=await z.getList(s):o=await z.getList2(s);let E=[],D=[],N=[],V,F;S=="1"?(e.tableData=((r=o.data.turnoverVOS)==null?void 0:r.map(m=>L({},m)))||[],o.data.histogramTurnoverVOS.forEach(m=>{E.push(m.targetAmount||0),D.push(m.turnover||0),N.push(m.time||0)}),V="\u76EE\u6807\u91D1\u989D",F="\u6210\u4EA4\u91D1\u989D"):(e.tableData=((b=o.data.refundTurnoverVOS)==null?void 0:b.map(m=>L({},m)))||[],o.data.refunds.forEach(m=>{E.push(m.targetAmount||0),D.push(m.refundAmount||0),N.push(m.time||0)}),V="\u76EE\u6807\u91D1\u989D",F="\u56DE\u6B3E\u91D1\u989D"),e.chartData={arr1:E,arr2:D,xAxis:N,label:[V,F]},e.tabData=o.data}catch{e.tableData=[]}};return(o,r)=>{const b=h("el-date-picker"),s=h("el-form-item"),S=h("el-option"),E=h("el-select"),D=h("el-button"),N=h("el-form"),V=h("TableTemp"),F=pe("has-perm");return p(),A("div",null,[f("div",null,[i(N,{inline:!0,model:t(c),"label-width":"150px"},{default:d(()=>[i(s,null,{default:d(()=>[i(b,{"value-format":"YYYY",format:"YYYY",clearable:!1,modelValue:t(c).year,"onUpdate:modelValue":r[0]||(r[0]=u=>t(c).year=u),type:"year"},null,8,["modelValue"])]),_:1}),i(s,null,{default:d(()=>[i(E,{modelValue:t(c).departmentId,"onUpdate:modelValue":r[1]||(r[1]=u=>t(c).departmentId=u),placeholder:"\u9009\u62E9\u90E8\u95E8",onChange:I},{default:d(()=>[(p(!0),A(H,null,P(t(C),u=>(p(),k(S,{label:u.label,value:u.value,key:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(s,null,{default:d(()=>[i(E,{modelValue:t(c).userId,"onUpdate:modelValue":r[2]||(r[2]=u=>t(c).userId=u),placeholder:"\u9009\u62E9\u4EBA\u5458"},{default:d(()=>[(p(!0),A(H,null,P(t(g),u=>(p(),k(S,{label:u.userName,value:u.userId,key:u.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(s,null,{default:d(()=>[i(D,{type:"primary",onClick:R},{default:d(()=>[ye]),_:1}),i(D,{type:"",onClick:O},{default:d(()=>[xe]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",Ee,[i(ge,{width:"100%",height:"280px",data:t(B)},null,8,["data"])]),f("div",Ae,[f("div",Ce,[f("span",null,"\u76EE\u6807\u91D1\u989D\uFF1A\xA5 "+Y(t(x).targetAmount||0),1),f("span",null,"\u56DE\u6B3E\u91D1\u989D\uFF1A\xA5 "+Y(t(x).turnover||t(x).refundAmount||0),1),f("span",null,"\u5B8C\u6210\u7387\uFF1A"+Y(t(x).completionRate||0)+"%",1)]),f("div",null,[_e((p(),k(D,{type:"primary",onClick:t(T)},{default:d(()=>[Be]),_:1},8,["onClick"])),[[F,"crm:client:report:export"]])])]),i(V,{comheight:590,style:{width:"100%"},isBorder:!0,isSelection:!1,isIndex:!1,isPagination:!0,isShowCustomBtn:!1,loading:!1,isHandle:!0,isShowPageBtn:!1,tableData:t(n),tableCols:t(y),tableHandles:t(v),pagination:t(_),onRefresh:w},null,8,["tableData","tableCols","tableHandles","pagination"])])}}});var we=ie(Ie,[["__scopeId","data-v-bdd410a0"]]);const Se={class:"main"},Te=U({__name:"index",setup(l){const a=W({activeName:"",list:[{label:"\u6210\u4EA4\u91D1\u989D",value:"1"},{label:"\u56DE\u6B3E\u91D1\u989D",value:"2"}]}),{activeName:e,list:c}=G(a),C=(g,v)=>{a.activeName=g.props.name};return K(()=>{a.activeName="1"}),(g,v)=>{const y=h("el-tab-pane"),_=h("el-tabs");return p(),A("div",Se,[i(_,{modelValue:t(e),"onUpdate:modelValue":v[0]||(v[0]=n=>he(e)?e.value=n:null),onTabClick:C,type:"border-card"},{default:d(()=>[(p(!0),A(H,null,P(t(c),(n,B)=>(p(),k(y,{label:n.label,key:B,name:n.value},{default:d(()=>[n.value==t(e)?(p(),k(we,{key:0,activeName:t(e)},null,8,["activeName"])):be("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}});export{Te as default};
