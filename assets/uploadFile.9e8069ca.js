import{_ as q,d as K,r as h,V,L as P,M as G,a as v,h as _,b as H,c as J,e as i,m as B,x as n,U as Q,y as W,G as D,p as X,l as Y,a0 as w,ay as E}from"./index.052afee0.js";const Z=F=>(X("data-v-4252e5cd"),F=F(),Y(),F),$=D("\u9009\u62E9\u9644\u4EF6"),ee=Z(()=>B("div",{class:"el-upload__tip"}," \u652F\u6301\u683C\u5F0F\uFF1A.rar .zip .doc .docx .pdf \uFF0C\u5355\u4E2A\u6587\u4EF6\u4E0D\u80FD\u8D85\u8FC720MB ",-1)),te={class:"dialog-footer",style:{"text-align":"center"}},ae=D("\u4FDD\u5B58"),oe=D("\u53D6\u6D88"),le=K({__name:"uploadFile",props:{openType:{type:String,default:"order"}},emits:["success"],setup(F,{expose:R,emit:S}){const A=F,U=h(),k=h(V),d=P({title:"",visible:!1,formData:{remarks:""},rules:{},data:{}}),{visible:y,formData:x,rules:se}=G(d);let I=async(t={})=>{d.data=t,d.visible=!0};const c=h([]);function T(t){let{ak:e,sk:l,securityToken:s,server:a}=t||{};console.log("\u5F00\u59CB\u4F20");var p=new ObsClient({security_token:s,access_key_id:e,secret_access_key:l,server:a,timeout:60*5});return p}async function z(t,e){return new Promise((l,s)=>{T(e).putObject({Bucket:e.bucket,Key:e.objectKey,Metadata:{property:"property-value"},SourceFile:t,ProgressCallback:function(a,p,u){}}).then(function(a){a.CommonMsg.Status==200?l(a):s({})}).catch(function(a){s(a),console.error(a)})})}function M(t){return t?(t/(1024*1024)).toFixed(2):0}const O=async()=>{var a,p;let t=[],e=[],l={},s=!0;for(let u=0;u<c.value.length;u++){const r=c.value[u];s&&(s=M(r.size)<20)}if(!s)return w.error("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 20MB!"),!1;try{for(let m=0;m<c.value.length;m++){const o=c.value[m];let b=(p=(a=o==null?void 0:o.name)==null?void 0:a.split("."))==null?void 0:p.reverse()[0],f=await md52base64(o.raw);f=f+"."+b,l[f]=o.raw,e.push(f),t.push({fileName:o.name,fileVerify:f,fileSize:o.size})}let u=await E.getUploadUrl({fileVerifies:e});if(u.data){let m=u.data;for(let o=0;o<m.length;o++){const{actualSignedRequestHeaders:b,fileVerify:f}=m[o];let ue=await z(l[f],b)}console.log("\u4E0A\u4F20\u5B8C\u6210")}let{remarks:r}=d.formData,{orderId:j,taskId:L}=d.data,g={fileDTOS:t,remarks:r};A.openType=="order"?(g.orderId=j,await E.uploadOrderFile(g)):A.openType=="task"&&(g.taskId=L,await E.uploadTaskFile(g)),w.success("\u4E0A\u4F20\u6210\u529F\uFF01"),C(),S("success")}catch{w.success("\u4E0A\u4F20\u5931\u8D25\uFF01")}};function N(){k.value.validate(t=>{t&&O()})}function C(){k.value.resetFields(),d.visible=!1,c.value=[],Object.assign(d.formData,{remarks:""})}return R({init:I}),(t,e)=>{const l=v("el-button"),s=v("el-upload"),a=v("el-form-item"),p=v("el-input"),u=v("el-dialog");return _(y)?(H(),J(u,{key:0,title:"\u4E0A\u4F20\u9644\u4EF6",modelValue:_(y),"onUpdate:modelValue":e[2]||(e[2]=r=>Q(y)?y.value=r:null),width:"700px",onClose:C,"close-on-click-modal":!1,"append-to-body":""},{footer:i(()=>[B("div",te,[n(l,{type:"primary",onClick:N},{default:i(()=>[ae]),_:1}),n(l,{onClick:C},{default:i(()=>[oe]),_:1})])]),default:i(()=>[n(_(V),{ref_key:"dataFormRef",ref:k,model:_(x),"label-width":"130px"},{default:i(()=>[n(a,{label:"\u4E0A\u4F20\u9644\u4EF6:",prop:"description"},{default:i(()=>[n(s,{"file-list":c.value,"onUpdate:file-list":e[0]||(e[0]=r=>c.value=r),ref_key:"uploadRef",ref:U,class:"upload-demo",action:"#",method:"put","auto-upload":!1,multiple:"",limit:10},{tip:i(()=>[ee]),default:i(()=>[n(l,{type:"primary"},{default:i(()=>[$]),_:1})]),_:1},8,["file-list"])]),_:1}),n(a,{label:"\u5907\u6CE8\u4FE1\u606F:"},{default:i(()=>[n(p,{modelValue:_(x).remarks,"onUpdate:modelValue":e[1]||(e[1]=r=>_(x).remarks=r),type:"textarea",rows:6,maxlength:"300","show-word-limit":"",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])):W("",!0)}}});var re=q(le,[["__scopeId","data-v-4252e5cd"]]);export{re as U};
