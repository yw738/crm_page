var se=Object.defineProperty,ue=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var k=(i,o,l)=>o in i?se(i,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[o]=l,C=(i,o)=>{for(var l in o||(o={}))ce.call(o,l)&&k(i,l,o[l]);if(L)for(var l of L(o))pe.call(o,l)&&k(i,l,o[l]);return i},B=(i,o)=>ue(i,re(o));import{_ as de,d as j,s as me,ad as he,q as V,an as fe,L as J,X as be,W as ye,al as ge,r as F,M as P,o as W,af as _e,$ as f,am as U,ao as H,E as z,a0 as M,ah as Fe,a as w,b as v,f as E,x as p,h as s,e as q,F as ve,g as we,c as O,y as Se,U as De}from"./index.052afee0.js";import{T as Ce}from"./TransferUser.6bd2da35.js";import{M as Be}from"./Move2Sea.b211088a.js";import{F as Ee}from"./FollowTask.dc6c96ed.js";import{U as xe}from"./index.72de21bc.js";import{A as Te}from"./AddCooperation.ab5de2f8.js";import{A as Ae}from"./add.b4a773fe.js";import"./index.4950eb20.js";const Ie=j({__name:"index",props:{activeName:{type:String}},emits:["openApp"],setup(i,{emit:o}){const l=i;me(),he("calsType","crm:client:list");const{user:u}=V(),S=fe("openSms"),n=J({searchData:{keyWords:null,clientSource:null,clientType:null,clientStar:null,followStartDate:null,followEndDate:null,belongUserId:null,followUpStatus:null,isTopSort:!0},selectList:[],requestData:{companyId:u.userInfo.companyId},searchForm:[{type:"input",prop:"keyWords",width:"180px",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",change:()=>{}},{type:"select",prop:"clientSource",placeholder:"\u6765\u6E90",width:"180px",options:be,change:()=>{}},{type:"select",prop:"clientType",placeholder:"\u5BA2\u6237\u7B49\u7EA7",width:"180px",options:ye,change:()=>{}},{type:"select",prop:"belongUserId",placeholder:"\u5F52\u5C5E\u4EBA\u5458",width:"180px",options:[],change:()=>{}},{type:"select",prop:"followUpStatus",placeholder:"\u8DDF\u8FDB\u72B6\u6001",width:"180px",options:ge,change:()=>{}}],searchHandle:[{label:"\u67E5\u8BE2",type:"primary",icon:"Search",handle:()=>Q()},{label:"\u91CD\u7F6E",handle:()=>Y()}],tableHandles:[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",handle:()=>A()},{label:"\u5BFC\u5165",icon:"Upload",handle:e=>x()},{label:"\u5BFC\u51FA",icon:"Download",handle:()=>T()},{label:"\u8F6C\u79FB\u5BA2\u6237",handle:()=>ee()},{label:"\u6DFB\u52A0\u534F\u4F5C",handle:()=>Z()},{label:"\u79FB\u5165\u516C\u6D77",handle:()=>ae()},{label:"\u53D1\u9001\u77ED\u4FE1",handle:()=>S(!0,n.selectList)}],tableCols:[{label:"\u64CD\u4F5C",type:"Button",width:"340px",btnList:[{label:"\u8DDF\u8FDB",type:"primary",size:"small",icon:"Share",handle:(e,a)=>te(e)},{type:"primary",label:"\u7F16\u8F91",icon:"Edit",size:"small",handle:(e,a)=>ie(e)},{type:"primary",label:"\u7F6E\u9876",size:"small",icon:"SortUp",handle:(e,a)=>ne(e)},{type:"danger",label:"\u5220\u9664",icon:"Delete",size:"small",handle:(e,a)=>oe(e)}]}],tableData:[],appTableData:[],pagination:{pageSize:10,pageIndex:1,total:0},treeData:[],allList:[]}),r=F(null),y=F(null),d=F(null),m=F(null),g=F(null),_=F(null),{searchData:b,searchForm:D,searchHandle:R,tableHandles:$,tableCols:X,pagination:G,tableData:K}=P(n);W(()=>{l.activeName!="2"&&(n.tableHandles=[{label:"\u6DFB\u52A0",type:"primary",icon:"Plus",handle:()=>A()},{label:"\u5BFC\u5165",icon:"Upload",handle:e=>x()},{label:"\u5BFC\u51FA",icon:"Download",handle:()=>T()}]),_e("crm:client:list").then(e=>{n.tableCols=[...e,...n.tableCols]}),c(),f.queryEmployee().then(e=>{var a;n.searchForm[3].options=(a=e.data)==null?void 0:a.map(t=>({label:t.name,value:t.id}))})});let x=e=>{var a;(a=g==null?void 0:g.value)==null||a.init()},T=()=>{let{activeName:e}=l,a=JSON.parse(JSON.stringify(n.searchData));a.queryType=U(l.activeName,H),e=="2"?fileDown("myClient",a):e=="3"?fileDown("underClient",a):e=="5"?fileDown("cooperClient",a):e=="6"&&fileDown("subordClient",a)};const Q=()=>{n.pagination.pageIndex=1,c()},Y=()=>{Object.assign(n.searchData,{keyWords:null,clientSource:null,clientType:null,clientStar:null,followStartDate:null,followEndDate:null,belongUserId:null,followUpStatus:null})};let Z=()=>{var a;let e=n.selectList.map(t=>t.clientId).join(",");(a=_==null?void 0:_.value)==null||a.init("business",e)},ee=()=>{var a;let e=n.selectList.map(t=>t.clientId).join(",");(a=y==null?void 0:y.value)==null||a.init(e,"zhaunyi")},ae=()=>{var a;let e=n.selectList.map(t=>t.clientId).join(",");(a=d==null?void 0:d.value)==null||a.init(e)},te=(e,a)=>{var t;(t=m==null?void 0:m.value)==null||t.init("customer",e)},le=e=>{n.selectList=e.selection},ne=(e,a)=>{z.confirm("\u8BE5\u64CD\u4F5C\u5C06\u7F6E\u9876\u3002","\u786E\u5B9A\u7F6E\u9876\u5417\uFF1F").then(()=>{var t;(t=f)==null||t.top(e.clientId).then(h=>{M.success("\u7F6E\u9876\u6210\u529F"),I()})}).catch(()=>{})},oe=(e,a)=>{z.confirm("\u8BE5\u6570\u636E\u5C06\u6C38\u4E45\u88AB\u5220\u9664\uFF0C\u5E76\u4E14\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F","\u63D0\u793A").then(async()=>{var t;try{l.activeName=="4"||l.activeName=="5"?await f.cooperation({cooperationType:"DELETE",clientId:e.clientId,cooperationUserId:u.userInfo.id,departmentId:u.userInfo.departmentId}):await((t=f)==null?void 0:t.del(e.clientId)),M.success("\u5220\u9664\u6210\u529F"),I()}catch{}}).catch(()=>{})},A=()=>{var e;(e=r==null?void 0:r.value)==null||e.init("add",{dialogType:"0"})},ie=(e,a)=>{var t;(t=r==null?void 0:r.value)==null||t.init("edit",B(C({},e),{dialogType:"0"}))};const I=()=>{c()},c=async()=>{var a;let e=null;try{let t=JSON.parse(JSON.stringify(n.searchData));t.current=n.pagination.pageIndex,t.size=n.pagination.pageSize,t.queryType=U(l.activeName,H);let{activeName:h}=l;h=="2"?e=await f.getList(t):h=="3"?e=await f.getUnderlingList(t):h=="5"?e=await f.getCooperateList(t):h=="6"&&(e=await f.getSubordList(t)),n.tableData=((a=e==null?void 0:e.data.records)==null?void 0:a.map(N=>B(C({},N),{clientState:findLabel(Fe,N.clientState)})))||[],n.pagination.total=(e==null?void 0:e.data.total)||0}catch{n.tableData=[]}};return(e,a)=>{const t=w("SearchForm"),h=w("TableTemp");return v(),E("div",null,[p(t,{id:"searchForm",searchData:s(b),searchForm:s(D),searchHandle:s(R)},null,8,["searchData","searchForm","searchHandle"]),p(h,{comheight:700,style:{width:"100%"},isBorder:!0,isSelection:!0,isIndex:!1,isPagination:!0,loading:!1,isHandle:!0,isShowPageBtn:!1,tableData:s(K),tableCols:s(X),tableHandles:s($),pagination:s(G),onRefresh:c,onSelectChage:s(le)},null,8,["tableData","tableCols","tableHandles","pagination","onSelectChage"]),p(Ce,{ref_key:"transferUserRef",ref:y,onSuccess:c},null,512),p(Be,{ref_key:"move2SeaRef",ref:d,onSuccess:c,type:"client"},null,512),p(Ee,{ref_key:"followTaskRef",ref:m,onSuccess:c,type:"customer"},null,512),p(Ae,{ref_key:"addRef",ref:r,onSuccess:c},null,512),p(xe,{ref_key:"uploadFileRef",ref:g,typeName:"client",onSuccess:c},null,512),p(Te,{ref_key:"addCooperationRef",ref:_},null,512)])}}});var Ne=de(Ie,[["__scopeId","data-v-6779c6bf"]]);const Le={class:"main"},Je=j({__name:"index",setup(i){const{user:o}=V(),l=J({activeName:"2",openId:null,openType:"",list:[{label:"\u6211\u7684\u5BA2\u6237",value:"2"},{label:"\u4E0B\u5C5E\u5BA2\u6237",value:"3"},{label:"\u6211\u534F\u4F5C\u7684",value:"5"},{label:"\u4E0B\u5C5E\u534F\u4F5C\u7684",value:"6"}]}),{activeName:u,list:S,openType:n}=P(l),r=(d,m)=>{l.activeName=d.props.name},y=d=>{};return W(()=>{o.userLevel==1&&(l.list=[{label:"\u6211\u7684\u5BA2\u6237",value:"2"},{label:"\u6211\u534F\u4F5C\u7684",value:"5"}]),l.activeName=l.list[0].value}),(d,m)=>{const g=w("el-tab-pane"),_=w("el-tabs");return v(),E("div",Le,[p(_,{modelValue:s(u),"onUpdate:modelValue":m[0]||(m[0]=b=>De(u)?u.value=b:null),onTabClick:r,type:"border-card"},{default:q(()=>[(v(!0),E(ve,null,we(s(S),(b,D)=>(v(),O(g,{label:b.label,key:D,name:b.value},{default:q(()=>[b.value==s(u)?(v(),O(Ne,{key:0,activeName:s(u),onOpenApp:y},null,8,["activeName"])):Se("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}});export{Je as default};
